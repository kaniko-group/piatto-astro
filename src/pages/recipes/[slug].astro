---
import { fetchRecipes } from "../../utils/fetchRecipes";

// Fetching recipes to render first post
const recipes = await fetchRecipes();
const post = recipes[0];  // Assuming you're rendering the first post

// âœ… Clean YouTube lazyload embeds at build time
post.content.rendered = post.content.rendered
  .replace(
    /<iframe([^>]+)data-src="([^"]+)"([^>]*)src="[^"]+"([^>]*)>/g,
    '<iframe$1src="$2"$3$4>'
  )
  .replace(/\s+loading="lazy"/g, ''); // Optional: strip lazy attr if present

// Tell Astro which pages to build
export async function getStaticPaths() {
  const posts = await fetchRecipes();
  return posts.map(post => ({
    params: { slug: post.slug },
  }));
}
---

<html>
  <head>
    <title>{post.title.rendered}</title>
  </head>
  <body class="bg-white text-gray-900 font-sans p-6 md:p-10 max-w-3xl mx-auto mb-20">
    <h1 class="text-4xl font-extrabold mb-6 leading-tight">
      {post.title.rendered}
    </h1>

    <div
      class="prose prose-lg max-w-none prose-headings:font-semibold prose-h1:text-3xl prose-h2:text-2xl prose-h3:text-xl prose-p:my-4 prose-img:my-6 prose-figure:my-6"
      set:html={post.content.rendered}
    ></div>
  </body>
</html>
